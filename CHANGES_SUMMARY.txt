================================================================================
GO SDK UPDATE SUMMARY - MAJOR ENDPOINT CHANGES
================================================================================

Project: runagent-go
Date: October 21, 2025
File Modified: pkg/client/client.go

================================================================================
OVERVIEW
================================================================================

Major update to the Go SDK to align with the updated Python SDK endpoints.
The update includes significant changes to WebSocket endpoint structure, request
format, and message handling.

================================================================================
MAJOR ENDPOINT CHANGES
================================================================================

1. STREAMING ENDPOINT
   Old: /api/v1/agents/{agent_id}/execute/{entrypoint_tag}
   New: /agents/{agent_id}/run-stream?token={api_key}
   
   Impact: Simplified endpoint path, moved to root level, added API key
           authentication via query parameter

================================================================================
REQUEST FORMAT CHANGES
================================================================================

OLD REQUEST FORMAT (WebSocketMessage Wrapper):
   {
     "id": "stream_start",
     "type": "status",
     "timestamp": "2025-10-21T...",
     "data": {
       "action": "start_stream",
       "agent_id": "...",
       "input_data": {...}
     }
   }

NEW REQUEST FORMAT (Direct JSON):
   {
     "entrypoint_tag": "my_endpoint",
     "input_args": [...],
     "input_kwargs": {...},
     "timeout_seconds": 300,
     "async_execution": false
   }

REMOVED:
   - WebSocketMessage wrapper
   - ID, type, timestamp, data envelope
   - ExecutionRequest structure
   - Action and agent_id in request body

NEW TYPES:
   - StreamRequest: Simplified direct request format
   - StreamMessage: New response format (see below)

================================================================================
RESPONSE FORMAT CHANGES
================================================================================

OLD RESPONSE FORMAT:
   {
     "id": "...",
     "type": "status|ERROR",
     "timestamp": "...",
     "data": {...},
     "metadata": {...},
     "error": "..."
   }

NEW RESPONSE FORMAT (Simplified):
   {
     "type": "status|data|error",
     "status": "stream_started|stream_completed",
     "content": {...},
     "error": "...",
     "invocation_id": "...",
     "middleware_invocation_id": "...",
     "total_chunks": 10,
     "execution_time": 1.234
   }

CHANGES:
   - Removed: id, timestamp, data, metadata fields
   - Added: status, content fields
   - Added: invocation_id, middleware_invocation_id
   - Added: total_chunks, execution_time
   - Message type now has three values: "status", "data", "error"

================================================================================
STREAM MESSAGE TYPES
================================================================================

Type: "status"
   - status: "stream_started" → skip and get next message
   - status: "stream_completed" → end of stream
   - Returns: nil, false, nil

Type: "data"
   - Contains actual content in "content" field
   - Returns: content, true, nil

Type: "error"
   - Contains error message in "error" field
   - Returns: nil, false, error

================================================================================
CODE CHANGES SUMMARY
================================================================================

1. STRUCT REMOVALS:
   - ExecutionRequest (no longer needed)
   - WebSocketMessage (replaced by StreamMessage)

2. STRUCT ADDITIONS:
   - StreamRequest: Contains entrypoint_tag, input_args, input_kwargs, etc.
   - StreamMessage: Simplified message format with type, status, content, etc.

3. METHOD UPDATES:
   - RunStream(): 
     * New endpoint: /agents/{agent_id}/run-stream?token={api_key}
     * Uses StreamRequest instead of wrapped ExecutionRequest
     * Removes timestamp and ID generation
     * Direct JSON marshal instead of wrapper

4. SERIALIZER UPDATES:
   - SerializeMessage(): Now accepts interface{}, simplified to direct JSON marshal
   - DeserializeMessage(): Now returns *StreamMessage instead of *WebSocketMessage

5. STREAM ITERATOR UPDATES:
   - Next(): Updated to handle new message types (status/data/error)
     * type: "data" → returns content field
     * type: "status" → checks status field (stream_started/stream_completed)
     * type: "error" → returns error

================================================================================
COMPATIBILITY NOTES
================================================================================

BREAKING CHANGES:
   - WebSocket URL format has changed
   - Request/response message structures are different
   - Old clients will NOT work with new server
   - New clients will NOT work with old server

NON-BREAKING CHANGES:
   - All other endpoints remain the same:
     * Run() - HTTP POST execute endpoint
     * HealthCheck() - /health endpoint
     * GetAgentArchitecture() - /api/v1/agents/{agent_id}/architecture
     * GetAgentLimits() - /limits/agents
     * UploadMetadata() - /agents/metadata-upload
     * StartAgent() - /agents/{agent_id}/start
     * GetAgentStatus() - /agents/{agent_id}/status

GO BUILD STATUS: ✓ Successful

================================================================================
MIGRATION GUIDE
================================================================================

For users updating from old Go SDK:

1. Update WebSocket URL handling:
   - New format: /agents/{agent_id}/run-stream?token={api_key}
   - Token is passed as query parameter, not in headers

2. Update request handling:
   - No longer wrap request in WebSocketMessage
   - Send StreamRequest directly

3. Update message handling:
   - Check msg.Type for "status", "data", or "error"
   - Use msg.Content for actual data (not msg.Data)
   - Use msg.Status for status information

4. Example migration:
   OLD:
   - msg.Type == "status" with msg.Data["status"]
   
   NEW:
   - msg.Type == "status" with msg.Status

================================================================================
